<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Authentication Required</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .auth-container {
      background: white;
      padding: 35px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 380px;
      text-align: center;
    }

    .lock-icon {
      width: 70px;
      height: 70px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lock-icon svg {
      width: 35px;
      height: 35px;
      fill: white;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 22px;
    }

    .subtitle {
      color: #666;
      font-size: 14px;
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .form-group {
      margin-bottom: 18px;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-size: 14px;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .password-wrapper {
      position: relative;
    }

    .password-wrapper input {
      padding-right: 50px;
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      transition: color 0.2s;
    }

    .toggle-password:hover {
      color: #333;
    }

    .toggle-password svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      margin-bottom: 18px;
      display: none;
      text-align: left;
    }

    .error-message.show {
      display: block;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    button {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s, opacity 0.3s, transform 0.2s;
    }

    button:active:not(:disabled) {
      transform: scale(0.98);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-cancel {
      background: #f8f9fa;
      color: #333;
      border: 1px solid #ddd;
    }

    .btn-cancel:hover:not(:disabled) {
      background: #e9ecef;
    }

    .btn-confirm {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-confirm:hover:not(:disabled) {
      opacity: 0.9;
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="lock-icon">
      <svg viewBox="0 0 24 24">
        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
      </svg>
    </div>

    <h1>Admin Authentication</h1>
    <p class="subtitle">Only administrators can quit this application. Please enter admin credentials to continue.</p>

    <div class="error-message" id="errorMessage"></div>

    <form id="authForm">
      <div class="form-group">
        <label for="email">Admin Email</label>
        <input type="email" id="email" name="email" required autocomplete="off">
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <div class="password-wrapper">
          <input type="password" id="password" name="password" required autocomplete="off">
          <button type="button" class="toggle-password" id="togglePassword" title="Show password">
            <!-- Eye icon (show) -->
            <svg id="eyeShow" viewBox="0 0 24 24">
              <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
            </svg>
            <!-- Eye off icon (hide) - hidden by default -->
            <svg id="eyeHide" viewBox="0 0 24 24" style="display: none;">
              <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="btn-cancel" id="cancelBtn">Cancel</button>
        <button type="submit" class="btn-confirm" id="confirmBtn">Authenticate</button>
      </div>
    </form>
  </div>

  <script>
    const { send, on } = window.electronAPI;

    const form = document.getElementById('authForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const errorMessage = document.getElementById('errorMessage');
    const confirmBtn = document.getElementById('confirmBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const togglePassword = document.getElementById('togglePassword');
    const eyeShow = document.getElementById('eyeShow');
    const eyeHide = document.getElementById('eyeHide');

    let isSubmitting = false;
    let passwordVisible = false;

    // Toggle password visibility
    togglePassword.addEventListener('click', () => {
      passwordVisible = !passwordVisible;
      passwordInput.type = passwordVisible ? 'text' : 'password';
      eyeShow.style.display = passwordVisible ? 'none' : 'block';
      eyeHide.style.display = passwordVisible ? 'block' : 'none';
      togglePassword.title = passwordVisible ? 'Hide password' : 'Show password';
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      if (isSubmitting) return;

      const email = emailInput.value.trim();
      const password = passwordInput.value;

      if (!email || !password) {
        showError('Please enter both email and password');
        return;
      }

      isSubmitting = true;
      confirmBtn.innerHTML = '<span class="spinner"></span>Verifying...';
      confirmBtn.disabled = true;
      cancelBtn.disabled = true;
      hideError();

      send('admin-quit-auth', { email, password });
    });

    cancelBtn.addEventListener('click', () => {
      send('admin-quit-cancel');
    });

    on('admin-quit-response', (data) => {
      isSubmitting = false;
      confirmBtn.innerHTML = 'Authenticate';
      confirmBtn.disabled = false;
      cancelBtn.disabled = false;

      if (!data.success) {
        showError(data.message || 'Authentication failed');
        passwordInput.value = '';
        passwordInput.focus();
      }
      // If success, the window will be closed by main process
    });

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.add('show');
    }

    function hideError() {
      errorMessage.classList.remove('show');
    }

    // Focus email input on load
    emailInput.focus();
  </script>
</body>
</html>
